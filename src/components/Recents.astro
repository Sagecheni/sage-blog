---
import { getCollection } from "astro:content";
import type { BlogType } from "../content.config";
import FeatureCard from "./FeatureCard.astro";

const blogs: BlogType[] = await getCollection("blogs");
const blogs_ = blogs.map((blog) => {
  const words = (blog.body ?? "").split(/\s+/).filter(Boolean).length;
  const minutes = Math.ceil(words / 200);
  return {
    ...blog,
    data: { ...blog.data, readTime: minutes },
  };
});

// Filter posts from the last 3 months
const threeMonthsAgo = new Date();
threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);

const recentBlogs = blogs_
  .filter((blog: BlogType) => blog.data.date >= threeMonthsAgo)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
---

<h2 class="section-heading">R E C E N T S</h2>
<ul class="grid gap-3 py-6">
  {
    recentBlogs.map((blog: BlogType) => {
      return (
        <li>
          <FeatureCard
            title={blog.data.title}
            date={blog.data.date
              .toLocaleDateString("en-GB", {
                day: "numeric",
                month: "short",
                year: "numeric",
              })
              .slice(0, 11)}
            url={`/blog/${blog.data.slug}`}
            tags={blog.data.tags}
            readTime={blog.data.readTime}
          />
        </li>
      );
    })
  }
</ul>
