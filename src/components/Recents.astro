---
import { getCollection } from "astro:content";
import type { BlogType } from "../content.config";
import FeatureCard from "./FeatureCard.astro";

const blogs: BlogType[] = await getCollection("blogs");
const blogs_ = blogs.map((blog) => {
  const words = (blog.body ?? "").split(/\s+/).filter(Boolean).length;
  const minutes = Math.ceil(words / 200);
  return {
    ...blog,
    data: { ...blog.data, readTime: minutes },
  };
});

// Filter posts from the last 3 months
const threeMonthsAgo = new Date();
threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);

const recentBlogs = blogs_
  .filter((blog: BlogType) => blog.data.date >= threeMonthsAgo)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
---

<h2 class="section-heading transform -skew-x-12 inline-block bg-red-600 text-white px-4 py-1 mb-4 shadow-[4px_4px_0px_0px_rgba(255,255,255,1)]">R E C E N T S</h2>
<ul class="grid gap-3 py-6">
  {
    recentBlogs.map((blog: BlogType) => {
      return (
        <li class="transform transition-transform hover:-skew-x-2 hover:scale-[1.02] duration-300">
          <div style="clip-path: polygon(2% 0, 100% 0, 98% 100%, 0% 100%);">
          <FeatureCard
            title={blog.data.title}
            date={blog.data.date
              .toLocaleDateString("en-GB", {
                day: "numeric",
                month: "short",
                year: "numeric",
              })
              .slice(0, 11)}
            url={`/blog/${blog.data.slug}`}
            tags={blog.data.tags}
            readTime={blog.data.readTime}
          />
          </div>
        </li>
      );
    })
  }
</ul>
